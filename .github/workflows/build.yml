name: build not-kernel CI variant

on:
    push:
       branches: [ "main" ]
    workflow_dispatch:

jobs:
  build-kernel:
    runs-on: ubuntu-latest

    env:
      DEVICE: r8q
      DEVICE_NAME: Galaxy S20 FE
      KERNEL_NAME: not_kernel

    steps:
      - name: Check Out
        uses: actions/checkout@v3

      - name: Set Timezone
        uses: szenius/set-timezone@v1.2
        with:
          timezoneLinux: "America/Sao_Paulo"

      - name: Setting up the environment
        run: |
          sudo apt-get update -y
          sudo apt-get install -y gcc-aarch64-linux-gnu

      - name: Set Build Start Time
        run: echo "START_TIME=$(date +%s)" >> $GITHUB_ENV

      - name: Run build script
        run: |
          ./build.sh

      - name: Set Build End Time
        run: echo "END_TIME=$(date +%s)" >> $GITHUB_ENV

      - name: Calculate Build Duration
        run: |
          duration=$((END_TIME - START_TIME))
          minutes=$((duration / 60))
          seconds=$((duration % 60))
          echo "BUILD_DURATION=${minutes}m ${seconds}s" >> $GITHUB_ENV

      - name: Upload to Telegram
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          document: not-*.zip
          message: |
            âš™ï¸ not_kernel CI build complete!
            ğŸ“± Device â€“ Galaxy S20 FE (r8q)
             â€“ Check changes on github!
            â±ï¸ Build time â€“ ${{ env.BUILD_DURATION }}
            ğŸ“ Kernel Version - 4.19.325-graphene-st11rc:ELEMENT.
